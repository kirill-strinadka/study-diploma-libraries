
---

### Класс `SlideLibrary`

#### Описание
`SlideLibrary` — это центральный класс библиотеки для управления полиморфными слайд-объектами. Он предоставляет пользователю возможность создавать, перестраивать, записывать и воспроизводить слайды различных типов (например, растровые, видео), которые подгружаются динамически из указанных модулей. Класс интегрируется с `UIManager` для управления интерфейсом и использует `SlideStorage` для сохранения данных о записанных слайдах.

Этот класс предназначен для:
- Динамической загрузки модулей слайдов из локальных или удаленных источников (например, URL).
- Управления текущим активным слайдом. Можно начать/остановить запись команд для текущего слайда.
- Поддержки записи и воспроизведения действий пользователя на слайде.
- Обеспечения гибкости при добавлении новых типов слайдов без изменения основного кода.

#### Назначение
- **Управление слайдами**: Создание и пересоздание экземпляров слайдов разных типов.
- **Динамическая подгрузка**: Загрузка модулей слайдов по мере необходимости, что уменьшает начальную нагрузку на приложение.
- **Запись и воспроизведение**: Сохранение действий пользователя для последующего воспроизведения.
- **Хранение данных**: Сохранение записанных слайдов с помощью `SlideStorage`.

#### Конструктор
```javascript
constructor(uiManager, otherModules)
```
- **Параметры:**
    - `uiManager` (UIManager): Экземпляр менеджера интерфейса, который предоставляет доступ к контейнеру слайдов (`slideContainer`) и другим элементам UI.
    - `otherModules` (Object, опционально): Объект с дополнительными типами слайдов и путями к их модулям (например, `{ 'custom': './CustomSlide.js' }`). Если передан, объединяется с базовыми модулями.

- **Базовые модули**: По умолчанию доступны `'raster'` и `'video'`, определенные в `defaultModules`. Пользовательские модули добавляются или переопределяют базовые.

#### Свойства
- `uiManager` (UIManager): Ссылка на менеджер интерфейса для взаимодействия с UI.
- `slideStorage` (SlideStorage): Экземпляр класса для хранения данных о записанных слайдах.
- `currentSlide` (Slide|null): Текущий активный слайд или `null`, если слайд не создан.
- `slideModules` (Object): Объект, содержащий типы слайдов (ключи) и пути к их модулям (значения). Например:
  ```javascript
  {
      'raster': './PlaybackRasterGraphicsSlide.js',
      'video': './PlaybackVideoSlide.js',
      'custom': './PlaybackCustomSlide.js'
  }
  ```
- `loadedModules` (Object): Кэш загруженных модулей, где ключ — тип слайда, значение — класс слайда.

#### Методы

##### `async loadSlideModule(type)`
- **Описание**: Асинхронно загружает модуль слайда по его типу. Использует кэш для повторных вызовов.
- **Параметры**: `type` (string) — тип слайда (например, `'raster'`).
- **Возвращает**: Класс слайда (например, `RasterGraphicsSlide`).
- **Выбрасывает**: `Error`, если тип слайда неизвестен или модуль не удалось загрузить.

##### `async createSlide(type, ...args)`
- **Описание**: Создает новый экземпляр слайда указанного типа, загружая его модуль, если он еще не загружен. Устанавливает созданный слайд как текущий (`currentSlide`).
- **Параметры**:
    - `type` (string): Тип слайда (например, `'video'`).
    - `...args`: Аргументы, передаваемые в конструктор слайда (зависят от реализации).
- **Возвращает**: Экземпляр слайда.
- **Пример**:
  ```javascript
  const slide = await slideLib.createSlide('raster', 'image.jpg');
  ```

##### `async recreateSlide()`
- **Описание**: Пересоздает текущий слайд, используя его тип и аргументы, полученные через `getCreationArgs`. Полезно для сброса состояния слайда перед записью.
- **Возвращает**: Новый экземпляр слайда.
- **Примечание**: Требует, чтобы `currentSlide` был установлен.

##### `async startRecording(key)`
- **Описание**: Запускает запись действий пользователя на текущем слайде. Пересоздает слайд для чистого состояния и начинает запись.
- **Параметры**: `key` (string) — уникальный идентификатор записи.
- **Выбрасывает**: `Error`, если `key` не указан.

##### `stopRecording()`
- **Описание**: Останавливает запись действий, сохраняет данные слайда в `slideStorage` и возвращает ключ записи.
- **Возвращает**: `string` — ключ записи.

##### `playRecording(key)`
- **Описание**: Воспроизводит записанные действия для слайда по указанному ключу. Выводит команды в консоль для отладки.
- **Параметры**: `key` (string) — ключ записи.
- **Примечание**: Слайд должен быть загружен и поддерживать метод `play`.

##### `getSlideByKey(key)`
- **Описание**: Возвращает данные слайда из хранилища по ключу.
- **Параметры**: `key` (string) — ключ записи.
- **Возвращает**: Данные слайда или `null`, если запись не найдена.

##### `clearStorage()`
- **Описание**: Очищает все сохраненные записи в `slideStorage`.

##### `createPlaybackButton(key, container)`
- **Описание**: Создает кнопку для воспроизведения записи и добавляет её в указанный контейнер.
- **Параметры**:
    - `key` (string): Ключ записи.
    - `container` (HTMLElement): DOM-элемент, куда будет добавлена кнопка.
- **Примечание**: Может быть вынесен в отдельный модуль для лучшей модульности.

#### Использование для пользователя

##### Инициализация
Создайте экземпляр `SlideLibrary`, передав `UIManager` и, при необходимости, дополнительные модули:
```javascript
import { SlideLibrary } from './SlideLibrary.js';
import { UIManager } from './UIManager.js';

const uiManager = new UIManager(document.getElementById('slide-container'));
const customModules = {
    'text': './PlaybackTextSlide.js'
};
const slideLib = new SlideLibrary(uiManager, customModules);
```

##### Создание слайда
Создайте слайд асинхронно, указав тип и аргументы:
```javascript
async function initSlide() {
    const slide = await slideLib.createSlide('raster', 'image.jpg');
    console.log('Слайд создан:', slide);
}
initSlide();
```

##### Запись и воспроизведение
Запустите запись, остановите её и создайте кнопку воспроизведения:
```javascript
await slideLib.startRecording('my-base-slide');
setTimeout(() => {
    const key = slideLib.stopRecording();
    slideLib.createPlaybackButton(key, document.getElementById('playback-container'));
}, 5000);
```

#### Важная информация для пользователя
- **Асинхронность**: Методы `createSlide`, `recreateSlide`, `startRecording` возвращают промисы. Используйте `await` или `.then()` для работы с результатами.
- **Добавление модулей**: Передавайте свои модули через `otherModules` в конструкторе. Например:
  ```javascript
  const myModules = { 'custom': 'https://example.com/CustomSlide.js' };
  const slideLib = new RecordingSlideLibrary(uiManager, myModules);
  ```
- **Требования к слайдам**: Все модули должны экспортировать класс, наследующийся от `Slide`, с реализованными методами `getCreationArgs`, `render` и т.д.
- **Хранение**: Записи сохраняются в `slideStorage`. Очищайте хранилище с помощью `clearStorage()`, если нужно сбросить данные.

#### Примечания
- Библиотека рассчитана на работу с динамически подгружаемыми слайдами, что делает её легкой и гибкой.
- Подходит для приложений с интерактивными слайдами, где требуется запись и воспроизведение действий.

---

