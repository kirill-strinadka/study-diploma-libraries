
---

# SlideSync: Набор модулей для управления полиморфными слайдами в веб-приложениях

## Обзор проекта

**SlideSync** — это набор модулей на основе веб-технологий, предназначенный для управления интерактивными полиморфными слайдами в системах онлайн-обучения и презентаций. Он решает проблемы традиционных систем дистанционного обучения, таких как высокая нагрузка на сеть и недостаток удобных инструментов управления слайдами. SlideSync позволяет записывать команды управления слайдами и воспроизводить их синхронно с видео или графикой на стороне клиента, что снижает требования к пропускной способности сети и повышает качество отображения.

Набор модулей разработан с использованием современных веб-технологий (HTML5, JavaScript и DHTML), что обеспечивает совместимость со стандартными браузерами и удобную интеграцию с онлайн-платформами. В отличие от устаревших технологий, таких как Flash, Silverlight или Java-апплеты, SlideSync ориентирован на актуальные стандарты веб-разработки.

**Цель проекта**: создание универсального инструмента для управления полиморфными слайдами, который можно интегрировать в образовательные платформы, обеспечивая запись, воспроизведение и синхронизацию действий с мультимедийными элементами.

---


## Что такое SlideSync и что он позволяет делать?

SlideSync — набор модулей, предоставляющий разработчикам инструменты для создания интерактивных слайдов с возможностью записи и воспроизведения действий. Он позволяет:

- **Создавать слайды разных типов**: растровые (для рисования) и видео (с управлением воспроизведением).
- **Записывать команды**: фиксировать действия пользователя (например, рисование линий или управление видео) с временными метками.
- **Воспроизводить команды**: синхронно выполнять записанные действия на стороне клиента.
- **Интегрировать в веб-приложения**: использовать модули в образовательных платформах для синхронизации слайдов с лекциями.

---

## Техническое описание набора модулей

### Полиморфизм и базовый класс Slide

SlideSync использует полиморфную архитектуру. Все слайды наследуются от абстрактного класса `Slide`, который задаёт общий интерфейс и логику:

- **Назначение Slide**:
    - Обеспечивает единый способ работы с любым типом слайда через абстрактные методы (`render`, `_executeCommand`, `createTools`).
    - Хранит команды в массиве `commands` с временными метками для записи и воспроизведения.

- **Как работают команды**:
    - При вызове метода `startRecording` начинается запись действий с временной меткой относительно начала записи.
    - Команды сохраняются как массивы вида `[время, действие, параметры]`, например, `[1000, "lineTo", [5000, 5000]]`.
    - Метод `play` воспроизводит команды с учётом временных задержек между действиями.

- **Инструменты**:
    - Каждый слайд определяет свои инструменты через метод `createTools`, которые регистрируются в `ToolManager`.
    - Выбранный инструмент влияет на параметры команд (например, цвет или толщина линии для растрового слайда).

- **Хранение и передача**:
    - Команды хранятся в объекте слайда и передаются в `SlideStorage` для сохранения по ключу.
    - Передача возможна через JSON для синхронизации между клиентами.

---


---

### Базовые классы слайдов

[PlaybackSlide](../slide-sync/modules/base-slide/PlaybackSlide.js) - слайд реализующий функционал воспроизведения команд слайда

[RecordingSlide](../slide-sync/modules/base-slide/RecordingSlide.js) - слайд реализующий функционал записи команд слайда.

#### Описание
Это базовые абстрактные классы в полиморфной библиотеке для работы с динамическими слайдами.
Они предоставляют общий интерфейс и базовую функциональность для всех типов реализаций слайдов
(например, растровых, видео, текстовых), которые наследуются от них.
Эти классы не предназначены для прямого использования — вместо этого они служат основой
для создания конкретных реализаций слайдов, обеспечивая единообразие их поведения.

Классы определяют абстрактные методы, которые должны быть переопределены в подклассах
для реализации конкретной логики.

`command` (Array) — массив `[timeInterval, action, options]` - единый интерфейс для команд.

#### Назначение
- **Унификация**: Обеспечивает единый интерфейс для всех типов слайдов, упрощая их интеграцию в библиотеку.
- **Полиморфизм**: Позволяет подклассам переопределять методы для реализации уникального поведения, сохраняя общую структуру.


### [PlaybackSlide](../slide-sync/modules/base-slide/PlaybackSlide.js)

Объект для воспроизведения команд.

#### Конструктор
```javascript
constructor(container, commands = [])
```

- **Параметры:**
    - `container` (HTMLElement): DOM-элемент, в котором будет отображаться слайд.
    - `commands` (Array): Массив команд для воспроизведения слайда.
    - `settings` (Object, опционально): Настройки слайда, такие как размеры (`width`, `height`) и другие параметры. По умолчанию: `{ width: 600, height: 400 }`.

#### Методы

##### `play()`
- **Описание**: Запускает воспроизведение команд слайда. Для него должен быть реализован метод `_executeCommand(command)`.

##### `getType()`
- **Описание**: Возвращает строку с названием типа конкретной реализации слайда.

##### `getSlideDTO()`
- **Описание**: Возвращает `SlideDTO` - объект необходимый для создания слайда из конструктора.
```js
export class SlideDTO {
    constructor(commands, content, type) {
        this.commands = commands; // Массив команд
        this.content = content;   // Контент слайда
        this.type = type;         // Тип слайда
    }
}
```

##### `getContent()`
- **Описание**: Возвращает дополнительный контент слайда (изображения, видео и т.п.). Зависист от реализации.

##### `clearContainer()`
- **Описание**: Очищает содержимое контейнера слайда в графическом интерфейса.
- **Использование**: Подготовка контейнера перед рендерингом нового содержимого.

##### `_executeCommand(command)`
- **Описание**: Применяет команду к HTML контейнеру слайда.

##### `_toInitState()`
- **Описание**: Очищает содержимое контейнера слайда в графическом интерфейса.
  Возвращает слайд к начальному состоянию, чтобы можно было его заново воспроизвести через `play()`


### [RecordingSlide](../slide-sync/modules/base-slide/RecordingSlide.js)

Объект для записи команд.

#### Конструктор
```javascript
constructor(container, toolsContainer, playbackSlide)
```

- **Параметры:**
    - `container` (HTMLElement): DOM-элемент, в котором будет отображаться слайд.
    - `toolsContainer` (HTMLElement): DOM-элемент, в котором будет отображаться панель инструментов
    - `playbackSlide` (PlaybackSlide): Объект реализации `PlaybackSlide`.
      Если его не передать, то в конструкторе создастся новый экземпляр.
      Его методы воспроизведения необходимы для моментального отображения действий команд на экране при записи.

#### Методы

##### `play()`
- **Описание**: Запускает воспроизведение команд слайда. Для него должен быть реализован метод `_executeCommand(command)`.


##### `createTools(toolManager)`
- **Описание**: Абстрактный метод для создания инструментов, специфичных для данного типа слайда. Вызывается с менеджером инструментов (`toolManager`).
  Каждый тип слайда может реализовывать свои инструменты по взаимодействию со слайдом.
- **Параметры**: `toolManager` (ToolManager) — объект для управления инструментами UI.
- **Выбрасывает**: `Error`, если не реализован в подклассе.

##### `startRecording()`
- **Описание**: Запускает таймер. Начинает запись команд.

##### `stopRecording()`
- **Описание**: Останавливает запись команд. Возвращает `SlideDTO`

##### `_prepareCommandAndExecute(action, options)`
- **Описание**: Запускает таймер. Начинает запись команд.
- **Параметры**:
    - `action` (string): Тип действия (например, `'draw'` или `'move'`) (необходимо переопределять в реализации).
    - `options` (Object): Параметры действия (необходимо переопределять в реализации).
- **Примечание**: Работает только во время записи (`recording === true`).


#### Пример реализации
```javascript
export default class PlaybackTextSlide extends PlaybackSlide {
  constructor(container, content, commands = [], ...restArgs) {
    super(container, commands);

    this.type = 'text';

    this.textColor = 'black';
    this.textFont = '16px Arial';
    this.container.style.position = 'relative';
  }

  _toInitState() {}

  _getCanvas() {
    return this.canvas;
  }

  render() {
    this.clearContainer();
    this.commands.forEach(cmd => this._executeCommand(cmd));
  }

  play() {
    this._toInitState();
    super.play();
  }

  _executeCommand(command) {
    const action = command[1];
    const options = command[2];

    if (textCommands[action]) {
      textCommands[action](this, options, this.uiManager.settings.width, this.uiManager.settings.height);
    } else {
      console.error(`Команда "${action}" не распознана`);
    }
  }

  getContent() {
    return [];
  }

  getType() {
    return this.type;
  }

}
```

```js
export default class RecordingTextSlide extends RecordingSlide {
  constructor(container, toolsContainer, ...restArgs) {
    super(container, toolsContainer, new PlaybackTextSlide(container, []));
    this.playbackSlide = new PlaybackTextSlide(container, [])
    this.container = container;
  }

  createTools(toolManager) {
    const toolsConfig = [
      ...textColors.map(({ label, color, title }) => ({
        label,
        title,
        action: () => (this.textColor = color),
      })),
      ...textFonts.map(({ label, font, title }) => ({
        label,
        title,
        action: () => (this.textFont = font),
      })),
    ];

    toolManager.registerTools(toolsConfig);
  }

  getCreationArgs() {
    return [...this.getContent()];
  }

  render() {
    this.playbackSlide.render();
  }

  startRecording() {
    this.recording = true;
    this.startTime = new Date().getTime();
    this.playbackSlide.clearContainer();
    this.container.addEventListener('click', this._onContainerClick);
  }

  stopRecording() {
    this.recording = false;
    this.container.removeEventListener('click', this._onContainerClick);
    return this.getSlideDTO();
  }

  _onContainerClick = (event) => {
    if (!this.recording) return;

    const position = [event.offsetX, event.offsetY];
    const text = prompt('Введите текст:');
    if (text) {
      this._prepareCommandAndExecute('setTextColor', this.textColor);
      this._prepareCommandAndExecute('setTextFont', this.textFont);
      this._prepareCommandAndExecute('addText', { position: norm(position, this.uiManager.settings.width, this.uiManager.settings.height), text });
    }
  };

}
```

---


## Как использовать SlideSync?

### Установка
1. Скачайте папку `slide-sync` с GitHub-репозитория проекта.
2. Скопируйте её в ваш проект в директорию, например, `src/modules/slide-sync`.
3. Подключите необходимые модули в вашем JavaScript-коде через импорт.

Доступны такие импорты
```
import { 
    Slide, 
    RasterGraphicsSlide,
    VideoSlide,
    SlideLibrary,
    SlideStorage,
    UIManager,
    ToolManager
} from './slide-sync';
```


---

### Классы
`SlideLibrary`
[PlaybackSlideLibrary](../slide-sync/modules/PlaybackSlideLibrary.js) - создает полиморфно слайды для воспроизведения

[RecordingSlideLibrary](../slide-sync/modules/RecordingSlideLibrary.js) - создает полиморфно слайды для записи


#### Описание
Позволяют пользователю динамически создавать объекты реализаций слайдов по их типу

Этот класс предназначен для:
- Динамической загрузки модулей слайдов из локальных или удаленных источников (например, URL).
- Обеспечения гибкости при добавлении новых типов слайдов без изменения основного кода.

#### Назначение
- **Управление слайдами**: Создание и пересоздание экземпляров слайдов разных типов.
- **Динамическая подгрузка**: Загрузка модулей слайдов по мере необходимости, что уменьшает начальную нагрузку на приложение.

#### Конструктор
```javascript
constructor(slideContainer, otherModules)
```
- **Параметры:**
    - `slideContainer` (HTMLElement): DOM-элемент, который используется для отображения слайдов
    - `otherModules` (Object, опционально): Объект с дополнительными типами слайдов и путями к их модулям (например, `{ 'custom': './CustomSlide.js' }`).
      Если передан, объединяется с базовыми модулями.

- **Базовые модули**: По умолчанию доступны `'raster'` и `'video'`, определенные в `defaultModules`.
  Пользовательские модули добавляются или переопределяют базовые.

#### Свойства
- `currentSlide` (Slide|null): Текущий активный слайд или `null`, если слайд не создан.
- `slideModules` (Object): Объект, содержащий типы слайдов (ключи) и пути к их модулям (значения). Например:
  ```javascript
  {
      'raster': './PlaybackRasterGraphicsSlide.js',
      'video': './PlaybackVideoSlide.js',
      'custom': './PlaybackCustomSlide.js'
  }
  ```
#### Методы

##### `async loadSlideModule(type)`
- **Описание**: Асинхронно загружает модуль слайда по его типу. Использует кэш для повторных вызовов.
- **Параметры**: `type` (string) — тип слайда (например, `'raster'`).
- **Возвращает**: Класс слайда (например, `RasterGraphicsSlide`).
- **Выбрасывает**: `Error`, если тип слайда неизвестен или модуль не удалось загрузить.

##### `async createSlide(type, ...args)`
- **Описание**: Создает новый экземпляр слайда указанного типа, загружая его модуль, если он еще не загружен.
  Устанавливает созданный слайд как текущий (`currentSlide`).

- **Параметры**:
    - `type` (string): Тип слайда (например, `'video'`).
    - `...args`: Аргументы, передаваемые в конструктор слайда (зависят от реализации).
- **Возвращает**: Экземпляр слайда.
- **Пример**:
  ```javascript
  const slide = await slideLib.createSlide('raster', 'image.jpg');
  ```

##### `async recreateSlide()`
- **Описание**: Пересоздает текущий слайд, используя его тип и аргументы, полученные через ``.
  Полезно для сброса состояния слайда перед записью
- **Возвращает**: Новый экземпляр слайда.
- **Примечание**: Требует, чтобы `currentSlide` был установлен.


#### Важная информация для пользователя
- **Асинхронность**: Методы `createSlide`, `recreateSlide` возвращают промисы. Используйте `await` или `.then()` для работы с результатами.
- **Добавление модулей**: Передавайте свои модули через `otherModules` в конструкторе. Например:
  ```javascript
  const myModules = { 'custom': 'https://example.com/CustomSlide.js' };
  const slideLib = new RecordingSlideLibrary(uiManager, myModules);
  ```
- **Требования к слайдам**: Все модули должны экспортировать класс, наследующийся от `PlaybackSlide` или `RecordingSlide` соответственно,
  с реализацией необходимых методов.

#### Примечания
- Библиотека рассчитана на работу с динамически подгружаемыми слайдами, что делает её легкой и гибкой.
- Подходит для приложений с интерактивными слайдами, где требуется запись и воспроизведение действий.

---

---

## Преимущества SlideSync

- **Снижение нагрузки на сеть**: Передаются только команды, а не видео или изображения целиком.
- **Гибкость**: Полиморфная структура позволяет добавлять новые типы слайдов.
- **Интеграция**: Легко встраивается в существующие платформы благодаря веб-технологиям.
- **Интерактивность**: Поддержка записи и воспроизведения действий пользователя.

---

## Пример использования SlideSync

В репозитории доступен пример кода, который демонстрирует, как использовать набор модулей SlideSync для создания интерактивного веб-приложения, позволяющего переключаться между растровыми и видео-слайдами, записывать действия пользователя и воспроизводить их. Код представляет собой клиентский скрипт, который интегрирует SlideSync с DOM-элементами HTML-страницы.

---

### Код примера

Код примера представлен в файле `./examples/examples.js`


---

### Описание примера


Этот пример создаёт простое веб-приложение, которое:
1. Позволяет пользователю переключаться между растровым слайдом (с фоновым изображением) и видео-слайдом (с видеофайлом).
2. Предоставляет интерфейс для записи действий пользователя (рисование на растровом слайде или управление видео).
3. Сохраняет записанные команды и создаёт кнопки для их воспроизведения.


### Пошаговое объяснение по использованию примера

1. **Запуск приложения**:
    - При загрузке страницы отображается растровый слайд с фоном и панель инструментов (цвета и толщина линий).

2. **Переключение слайдов**:
    - Нажмите "Видео-слайд", чтобы переключиться на видео. Появится видеоплеер с кнопками управления (Play, Skip и т.д.).

3. **Запись**:
    - Нажмите "Начать запись", введите название (например, "Демо1"), и начните рисовать на растровом слайде или управлять видео.
    - Все действия (движение мыши, нажатия кнопок) записываются с временными метками.

4. **Остановка и воспроизведение**:
    - Нажмите "Остановить запись". Появится новая кнопка с названием "Воспроизвести: Демо1".
    - Нажмите эту кнопку, и слайд воспроизведёт все записанные действия в том же порядке и с теми же интервалами.

5. **Смена типа слайда**:
    - Переключитесь на другой слайд (например, с растрового на видео). Предыдущие записи очистятся, и процесс начнётся заново.

---

